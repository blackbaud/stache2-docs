<stache
  showTableOfContents="true"
  pageTitle="Configuration and Data"
  navTitle="Configuration and data">

  <stache-page-summary>
    Data and configuration settings are an important feature of your documentation site. This section outlines how to make use of data in your documentation and how to properly configure your {{ stache.jsonData.global.productNameShort }} site.
  </stache-page-summary>

  <stache-page-anchor>
    JSON data service
  </stache-page-anchor>

  <p>
    {{ stache.jsonData.global.productNameShort }} can consume JSON data files and provide them to you for use in your {{ stache.jsonData.global.productNameShort }} templates and components. There is a default <stache-code>global.json</stache-code> file that you can use for any variable data you wish to include. For example, you can add a variable for your site name and use that variable anywhere you want the name to appear. If the name ever changes, you'd only have to edit the <stache-code>global.json</stache-code> file.
  </p>

  <p>
    Data you wish to consume should be placed in the <stache-code>src/stache/data/</stache-code> directory. For example:
  </p>

  <ul>
    <li>
      <i class="fa fa-folder"></i> src
      <ul>
        <li>
          <i class="fa fa-folder"></i> stache
          <ul>
            <li>
              <i class="fa fa-folder"></i> data
              <ul>
                <li>
                  <i class="fa fa-file"></i> example.json
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <sky-alert alertType="warning">
    <b>Note: </b> Make sure to name your files with names that can be converted to valid object keys. Ex: <stache-code>data_file.json</stache-code> or <stache-code>dataFile.json</stache-code></sky-alert>
  </sky-alert>


  <p>
    We can then use that data in a template like so:
  </p>

  <sky-code-block
    languageType="markup">
    <p>{{ stache.jsonData.example.key }}</p>
  </sky-code-block>

  <h3>
    Build time parsing
  </h3>
  <p>
    If you need your variable data to be parsed at build time instead of run time, such as inside a <a routerLink="content/code-block"><stache-code>sky-code-block</stache-code></a> or as an attribute value, you will need to add the <stache-code>@buildtime:</stache-code> flag to your variable binding:
  </p>
  <h4>
    In a <stache-code>sky-code-block</stache-code>:
  </h4>

  <sky-code-block
    languageType="markup">
     {&#123; @buildtime:stache.jsonData.global.productNameShort }} will render {{ @buildtime:stache.jsonData.global.productNameShort }}.

    {{ stache.jsonData.global.productNameShort }} will not.
  </sky-code-block>
  <h4>
    As an attribute:
  </h4>
  <sky-code-block languageType="markup">
    &lt;stache
      pageTitle="{&#123; @buildtime:stache.jsonData.global.productNameShort }} Title">
    &lt;/stache>
  </sky-code-block>

  <stache-page-anchor>
    Using data in a component
  </stache-page-anchor>
  <p>
    If you want to use the data in a component, you can do so with the <stache-code>StacheJsonDataService</stache-code> by adding it to your component.
  </p>

  <sky-code-block
    languageType="typescript">
    import { Component, OnInit } from '@angular/core';
    import { StacheJsonDataService } from '@blackbaud/stache';

    @Component({
      selector: 'my-component',
      template: './my-component.component.html'
    })
    export class MyComponent implements OnInit {

      public allData: any;
      public specificData: any;

      constructor(
        private dataService: StacheJsonDataService
      ) { }

      ngOnInit() {
        this.allData = this.dataService.getAll();
        this.specificData = this.dataService.getByName('example');
      }
    }
  </sky-code-block>

  <h3>
    Data service methods
  </h3>

  <p>
    The data service provides several methods for accessing the JSON data within components.
  </p>
  <p>
    <strong>Example file structure</strong>
  </p>
  <ul>
    <li>
      <i class="fa fa-folder"></i> data
      <ul>
        <li>
          <i class="fa fa-folder"></i> example.json
          <ul>
            <li>
              <i class="fa fa-folder"></i> nested.json
              <ul>
                <li>
                  <p>
                    <i class="fa fa-file"></i> second_nested.json
                  </p>
                  <sky-code-block
                    hideHeader="true"
                    hideCopyToClipboard="true">
                    {
                      "name": "Deep nest",
                      "array_items": [
                        {
                          "name": "array item 1"
                        },
                        {
                          "name": "array item 2"
                        }
                      ]
                    }
                  </sky-code-block>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <p>
        <stache-code>getAll()</stache-code> &mdash; returns all data in the {{ stache.jsonData.global.productNameShort }} JSON data.
      </p>
      <sky-code-block hideCopyToClipboard="true">
        this.dataService.getAll();
      </sky-code-block>
    </li>
    <li>
      <p>
        <stache-code>getByName(name: string)</stache-code> &mdash; returns the {{ stache.jsonData.global.productNameShort }} JSON data matching the name provided. Expects a string <stache-code>name</stache-code> for the data being retrieved. To retrieve nested data from the JSON structure, each name must be separated by a <stache-code>.</stache-code>.
      </p>
      <sky-code-block hideCopyToClipboard="true">
        this.dataService.getByName('example');

        this.dataService.getByName('example.nested.secondNested');

        this.dataService.getByName('example.nested.secondNested.array_items.1.name');
      </sky-code-block>
    </li>
    <li>
      <p>
        <stache-code>getNestedData(keys: string[])</stache-code> &mdash; returns the {{ stache.jsonData.global.productNameShort }} JSON data matching the keys provided. Expects an array of strings <stache-code>keys</stache-code> for the data being retrieved.
      </p>
      <sky-code-block hideCopyToClipboard="true">
        this.dataService.getNestedData(['example', 'nested', 'secondNested']);

        this.dataService.getNestedData(['example', 'nested', 'secondNested', 'array_items', '1', 'name']);
      </sky-code-block>
    </li>
  </ul>

  <stache-page-anchor>
    Configuration
  </stache-page-anchor>

  <p>
    App-specific configuration exists in the <stache-code>skyuxconfig.json</stache-code> file at the root of your project. This file should only contain app-specific settings that are required for the functionality of your site. For example, keys for Google Analytics or plugins. Any variables that you wish to use in your app content should be in <stache-code>global.json</stache-code> or a custom <stache-code>json</stache-code> file. The stache template provides a location under <stache-code>appSettings</stache-code> for {{ stache.jsonData.global.productNameShort }}-specific settings.
  </p>

  <sky-code-block
    languageType="json">
    {
      "mode": "easy",
      "compileMode": "aot",
      "auth": true,
      "plugins": [
        "@blackbaud/skyux-builder-plugin-stache",
        "@blackbaud/skyux-builder-plugin-auth-email-whitelist"
      ],
      "app": {
        "title": "Stache Template"
      },
      "appSettings": {
        "stache": { }
      }
    }
  </sky-code-block>

</stache>
